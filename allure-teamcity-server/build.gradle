apply plugin: "com.github.rodm.teamcity-server"

apply from: "${gradleScriptDir}/bintray.gradle"

teamcity {
    version = teamcityVersion
    server {
        descriptor = project.file('teamcity-plugin.xml')
        tokens = [Version: project.version]
    }

    environments {
        teamcity9 {
            version = '9.1'
            homeDir = file("$teamcityDir/${version}")
            dataDir = file("$teamcityDir/${version}/.datadir")
            serverOptions = serverOpts
        }

        teamcity10 {
            version = '10.0.2'
            homeDir = file("$teamcityDir/TeamCity-${version}")
            dataDir = file("$teamcityDir/data/${version}")
            serverOptions = serverOpts
        }
    }

}

serverPlugin {
    baseName = project.parent.name
    version = null //teamcity plugin file name should be without version suffix
}

configurations.archives.artifacts.removeAll { it.archiveTask.is jar }

dependencies {
    agent project(path: ':allure-teamcity-agent', configuration: 'plugin')

    compile project(':allure-teamcity-common')

    compile 'org.apache.commons:commons-lang3:3.4'
    provided 'javax.servlet:jstl:1.1.2'
}
